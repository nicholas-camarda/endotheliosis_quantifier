# Mitochondria Pretraining Configuration
# This is Step 1 of the segmentation pipeline - pretraining on mitochondria data
# The resulting model serves as the foundation for glomeruli fine-tuning

name: "mitochondria_pretraining"
description: "Initial U-Net training on mitochondria EM data for transfer learning"

# Data Pipeline Configuration
data:
  # Step 1: Raw TIF stack extraction
  raw_stack: "data/mitochondria_data/mitochondria-data-stack.tif"
  
  # Step 2: Extracted individual TIFs (already done)
  extracted_tifs:
    training: "data/mitochondria_data/training.tif"
    testing: "data/mitochondria_data/testing.tif"
    training_groundtruth: "data/mitochondria_data/training_groundtruth.tif"
    testing_groundtruth: "data/mitochondria_data/testing_groundtruth.tif"
  
  # Step 3: Converted JPG images
  converted_images:
    base_dir: "data/mitochondria_data"
    train_dir: "data/mitochondria_data/training"
    test_dir: "data/mitochondria_data/testing"
  
  # Step 4: Patch generation for U-Net (already completed)
  patches:
    size: 224  # U-Net input size - changed to match pretrained model
    overlap: 0.1  # 10% overlap between patches
    output_dir: "derived_data/mitochondria_data/training/image_patches"
    mask_output_dir: "derived_data/mitochondria_data/training/mask_patches"
  
  # Step 5: Data loading for U-Net training
  processed:
    train_dir: "derived_data/mitochondria_data/training/image_patches"
    train_mask_dir: "derived_data/mitochondria_data/training/mask_patches"
    cache_dir: "derived_data/mitochondria_data/cache"
    train_ratio: 0.8
    val_ratio: 0.2
    random_seed: 42

# Model Configuration
model:
  architecture: "dynamic_unet"
  backbone: "resnet34"
  input_size: [224, 224]
  num_classes: 2  # background + mitochondria
  
  # Training parameters
  training:
    epochs: 50
    batch_size: 16
    learning_rate: 1e-3
    weight_decay: 1e-4
    
  # Output configuration
  output_dir: "models/segmentation/mitochondria"
  model_name: "mito_dynamic_unet_seg_model-e50_b16"
  checkpoint_path: "models/segmentation/mitochondria/mito_dynamic_unet_seg_model-e50_b16.pkl"

# Hardware Configuration
hardware:
  device: "auto"  # auto-detect MPS/CUDA/CPU
  mixed_precision: true
  num_workers: 4

# Reproducibility
reproducibility:
  random_seed: 42
  deterministic: true

# Logging and Monitoring
logging:
  level: "INFO"
  save_plots: true
  plot_dir: "output/plots"
  
# Next Step Information
next_step:
  description: "Use this trained model as starting point for glomeruli fine-tuning"
  config_file: "configs/glomeruli_finetuning_config.yaml"
  checkpoint_to_use: "models/segmentation/mitochondria/mito_dynamic_unet_seg_model-e50_b16.pkl"
